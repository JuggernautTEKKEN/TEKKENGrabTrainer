<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timing Game with Score</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: black;
            flex-direction: column;
        }

        #gameContainer {
            position: relative;
            text-align: center;
        }

        video {
            width: 960px;
            height: 540px;
            display: none; /* Hide videos initially */
        }

        #scoreboard {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            color: white;
        }

        #failMessage, #successMessage {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            display: none;
        }

        #failMessage { color: red; }
        #successMessage { color: green; }
    </style>
</head>
<body>

    <div id="gameContainer">
        <div id="scoreboard">High Score: <span id="highScore">0</span></div>
        <!-- Preloading all videos -->
        <video id="defaultVideo" autoplay loop>
            <source src="https://juggernauttekken.github.io/TEKKENGrabTrainer/videos/Grab_1_MISSEDDEFAULT.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <video id="missedVideo" autoplay loop>
            <source src="https://juggernauttekken.github.io/TEKKENGrabTrainer/videos/Grab_1_WRONG.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <video id="correctVideo" autoplay loop>
            <source src="https://juggernauttekken.github.io/TEKKENGrabTrainer/videos/main/videos/Grab_1_SUCCESS.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div id="failMessage">You Failed! Try again.</div>
        <div id="successMessage">Correct! Well done! +<span id="scorePoints"></span></div>
    </div>

    <script>
        const defaultVideo = document.getElementById('defaultVideo');
        const missedVideo = document.getElementById('missedVideo');
        const correctVideo = document.getElementById('correctVideo');
        const failMessage = document.getElementById('failMessage');
        const successMessage = document.getElementById('successMessage');
        const scorePoints = document.getElementById('scorePoints');
        const highScoreDisplay = document.getElementById('highScore');

        let highScore = 0;

        const showStartTime = 0.12;
        const pressTimeLimit = 0.333;
        const showEndTime = showStartTime + pressTimeLimit;

        let isFailing = false;
        let isCorrectPressed = false;

        // Hide all videos initially
        function hideAllVideos() {
            defaultVideo.style.display = 'none';
            missedVideo.style.display = 'none';
            correctVideo.style.display = 'none';
        }

        // Reset to the default video
        function resetToDefaultVideo() {
            hideAllVideos();
            defaultVideo.style.display = 'block';
            defaultVideo.play();
            isFailing = false;
            isCorrectPressed = false;
            failMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }

        function calculateScore(pressTime) {
            let timeDiff = pressTime - showStartTime;
            let score = 0;

            if (timeDiff <= 0.1) {
                score = 888;
            } else if (timeDiff <= 0.2) {
                score = 400;
            } else if (timeDiff <= 0.333) {
                score = 300;
            }

            highScore += score;
            highScoreDisplay.innerText = highScore;
            return score;
        }

        function playMissedVideo() {
            hideAllVideos();
            missedVideo.style.display = 'block';
            missedVideo.play();
            isFailing = true;
            failMessage.style.display = 'block';
        }

        function playCorrectVideo(pressTime) {
            let score = calculateScore(pressTime);
            scorePoints.innerText = score;
            hideAllVideos();
            correctVideo.style.display = 'block';
            correctVideo.play();
            isCorrectPressed = true;
            successMessage.style.display = 'block';
        }

        defaultVideo.addEventListener('ended', resetToDefaultVideo);
        missedVideo.addEventListener('ended', resetToDefaultVideo);
        correctVideo.addEventListener('ended', resetToDefaultVideo);

        document.addEventListener('keydown', (event) => {
            if (defaultVideo.currentTime >= showStartTime && defaultVideo.currentTime <= showEndTime) {
                if (event.key === '1' && !isCorrectPressed) {
                    playCorrectVideo(defaultVideo.currentTime);
                } else if (event.key !== '1' && !isFailing) {
                    playMissedVideo();
                }
            }
        });

    </script>

</body>
</html>
